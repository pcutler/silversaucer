# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'
strategy:
  matrix:
    Python36:
      python.version: '3.6'
    Python37:
      python.version: '3.7'

steps:

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(python.version)'
    displayName: 'Use Python $(python.version)'

# Install SSH Key
# Install an SSH key prior to a build or release
  - task: InstallSSHKey@0
    inputs:
      hostName: github.com,192.30.253.112 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ==
      sshPublicKey: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8zMwq5iqDep5hZ4vzSPinieYiawWdJf/l1kZTX9CbkYtmTBTTvG5XIoFzuNfaL7XBs3Re7uljJGlDFvF9IJh1N5gsNnB0K3MNWVi6tcW99Y/KRDa6zF9KovMKaAouK6jval5SV+cXVRe/Xz44j9zC3pGni0ZziZAuotKu1R4cPKW04EvD7jTrl1Uz7gtsd28Bvc7dAtFJE3eN+O5pBAwXFjrUp8WGAj1p9uQdmaKJg1iRKuJFQtvostUxbimx863FJ7SQtoYlRWSdkw61Hsw3UQ+hQOmgF4v3IApT+yhcWCn+QqEFAPf23AbGXnef3MUSbI14ejK7wyawyFE8lo+Z paul@paulcutler.org
      #sshPassphrase: # Optional
      sshKeySecureFile: paulcutler_rsa

  - script: |
      python -m pip install --upgrade pip
      pip install -r requirements.txt
      displayName: 'Install dependencies'

  - script: |
      pip install pytest pytest-azurepipelines
      pytest
      displayName: 'pytest'
